<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>DB MWE — Professors & Courses</title>
    <style>
      body { font-family: system-ui, sans-serif; margin: 2rem auto; max-width: 750px; }
      fieldset { margin-bottom: 1rem; }
      ul { padding-left: 1rem; }
      li { margin: .25rem 0; }
      label { display: inline-block; width: 7rem; }
      input, select { padding: .25rem .4rem; }
      button { padding: .3rem .6rem; }
      .row { display: flex; gap: .5rem; align-items: center; }
    </style>
  </head>
  <body>
    <h1>DB MWE — Professors & Courses</h1>

    <fieldset>
      <legend>Add Professor</legend>
      <div class="row">
        <label for="professorName">Name</label>
        <input id="professorName" placeholder="e.g., Ursula K. Le Guin" />
        <button id="addProfessorBtn">Add Professor</button>
      </div>
    </fieldset>

    <fieldset>
      <legend>Add Course</legend>
      <div class="row">
        <label for="courseTitle">Title</label>
        <input id="courseTitle" placeholder="e.g., A Wizard of Earthsea" />
      </div>
      <div class="row" style="margin-top:.5rem">
        <label for="professorSelect">Professor</label>
        <select id="professorSelect"></select>
        <button id="addCourseBtn">Add Course</button>
      </div>
    </fieldset>

    <h2>Professors</h2>
    <ul id="professors"></ul>

    <h2>Courses</h2>
    <ul id="courses"></ul>

    <script>
      const qs = (s) => document.querySelector(s);
      const professorsEl = qs('#professors');
      const coursesEl = qs('#courses');
      const professorName = qs('#professorName');
      const courseTitle = qs('#courseTitle');
      const professorSelect = qs('#professorSelect');

      async function loadProfessors() {
        const r = await fetch('/api/professors');
        const data = await r.json();
        professorsEl.innerHTML = data.map(a => `<li>${a.name} (id=${a.id})</li>`).join('');
        professorSelect.innerHTML = data.map(a => `<option value="${a.id}">${a.name}</option>`).join('');
      }
      async function loadCourses() {
        const r = await fetch('/api/courses');
        const data = await r.json();
        coursesEl.innerHTML = data.map(b => `<li>${b.title} — <em>${b.professor_name}</em></li>`).join('');
      }

      async function addProfessor() {
        const name = professorName.value.trim();
        if (!name) return alert('Enter a name');
        const r = await fetch('/api/professors', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name })
        });
        if (!r.ok) {
          const t = await r.text();
          alert('Error: ' + t);
          return;
        }
        professorName.value='';
        await loadProfessors();
      }

      async function addCourse() {
        const title = courseTitle.value.trim();
        const professor_id = parseInt(professorSelect.value, 10);
        if (!title || !professor_id) return alert('Enter a title and select an professor');
        const r = await fetch('/api/courses', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ title, professor_id })
        });
        if (!r.ok) {
          const t = await r.text();
          alert('Error: ' + t);
          return;
        }
        courseTitle.value='';
        await loadCourses();
      }

      qs('#addProfessorBtn').addEventListener('click', addProfessor);
      qs('#addCourseBtn').addEventListener('click', addCourse);

      loadProfessors().then(loadCourses);
    </script>
  </body>
</html>
